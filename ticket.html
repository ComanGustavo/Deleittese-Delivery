<body>

    <div class="text-center">
        <h2>DELEITTESE</h2>
        <p>*** ORDEN DE COCINA ***</p>
    </div>

    <div class="linea"></div>

    <div id="contenedor-datos"></div>

    <div class="linea"></div>

    <div class="text-center">
        <p>Deleittese 2026</p>
    </div>

   <script>
    // 1. Función limpiarTexto (Mantenida según tu versión)
    function limpiarTexto(texto) {
        if (!texto) return "";
        return texto
            .normalize("NFD")                  
            .replace(/[\u0300-\u036f]/g, "")   
            .replace(/[¡¿!:#]/g, "")           
            .toUpperCase();                    
    }

    function renderTicket() {
        const params = new URLSearchParams(window.location.search);
        
        const nroTicket = params.get('id') || "000";

        // 2. Procesamos los productos
        const itemsRaw = params.get('items') ?? 'SIN PRODUCTOS';
        const productosArray = itemsRaw.split('\n'); 
        
        let detalleHTML = "";
        productosArray.forEach(prod => {
            if(prod.trim() !== "") {
                detalleHTML += `<div class="item-pedido">${limpiarTexto(prod.trim())}</div>`;
            }
        });

        const notaRaw = params.get('nota') || "";
        const notaLimpia = limpiarTexto(notaRaw);
        
        const obsHTML = notaLimpia.trim() !== "" 
            ? `<div class="obs-destacada">ATENCION: ${notaLimpia}</div>` 
            : `<div class="dato">SIN OBSERVACIONES ADICIONALES.</div>`;

        // 3. Renderizamos incluyendo el SUBTOTAL antes del ENVÍO
        const html = `
            <div class="text-center">
                <p style="font-size: 14px; font-weight: bold; margin: 0;">TICKET: #${nroTicket}</p>
            </div>
            <div class="linea"></div>

            <div class="dato"><b>CLIENTE:</b> ${limpiarTexto(params.get('cliente') ?? 'N/A')}</div>
            <div class="dato"><b>TEL:</b> ${params.get('tel') ?? 'N/A'}</div>
            <div class="dato"><b>DIR:</b> ${limpiarTexto(params.get('dir') ?? 'RETIRO')}</div>
            <div class="linea"></div>
            
            <div style="font-size: 10px; margin-bottom: 5px;">DETALLE DEL PEDIDO:</div>
            ${detalleHTML} 
            
            <div class="linea"></div>
            ${obsHTML}
            <div class="linea"></div>
            
            <div class="dato"><b>SUBTOTAL:</b> $${params.get('subtotal') ?? '0'}</div>
            <div class="dato"><b>ENVIO:</b> $${params.get('envio') ?? '0'}</div>
            <div class="total-box">TOTAL: $${params.get('total') ?? '0'}</div>
        `;
        
        document.getElementById("contenedor-datos").innerHTML = html;
    }

    window.onload = () => {
        renderTicket();
        setTimeout(() => { window.print(); }, 800);
    };
</script>
</body>